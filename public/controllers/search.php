<?php# КОНТРОЛЛЕР ПОИСКА ПО САЙТУ v.2.0# Coded by ShadoW (с) 2014class cnt_Search extends Controller{	private $_search = '';	private $_where	 = array(		'Поиск по текстовым страница сайта'	=> array('class'=>1, 'fields'=>array(1,2), 'container'=>'', 'name'=>'Заголовок', 'prefix'=>'page/show'),		'Поиск по новостям'					=> array('class'=>2, 'fields'=>array(5,9), 'container'=>31, 'name'=>'Заголовок', 'prefix'=>'articles/show'),		'Поиск по частным лицам'			=> array('class'=>2, 'fields'=>array(5,9), 'container'=>53, 'name'=>'Заголовок', 'prefix'=>'articles/show'),	);	# ИНИЦИАЛИЗАЦИЯ	public function init()	{		View::assign('%no_left', true);		if (isset($_GET['what']) && ($search = Helpers::escape($_GET['what'])) && (mb_strlen($search) >= 3))			$this->_search = $search;	}	# РЕДИРЕКТ	public function act_index()	{		$this->act_show();	}	# ПОИСК	public function act_show()	{		# ИЩЕМ В ЗАДАННЫХ РАЗДЕЛАХ		$found = array();		if ($this->_search != '')		{			foreach ($this->_where as $name=>$params)			{				$fields = array();				foreach($params['fields'] as $f) $fields[] = "c.f_$f LIKE '%".$this->_search."%'";				# ИЩЕМ				if ($search_items = Model::getObjects((is_int($params['container']) ? $params['container'] : -1), $params['class'], true, "o.active='1' AND (".join(' OR ', $fields).")"))				{					foreach($search_items as $i)					{						$found[] = array(							'name'		=> $i[$params['name']],							'url'		=> '/'.Core::$_lang.'/'.$params['prefix'].'/'.Helpers::hurl_encode($i['id'], $i[$params['name']]),							'anounce'	=> $params['class'] == 2 ? $i['Анонс'] : mb_substr(strip_tags($i['Текст']), 0, 400).'...'						);					}				}			}		}		# ВЫВОД		View::assign('%page_title', Core::$_data['main_locale']['search_results']);		View::assign('%page', array('name'=>Core::$_data['main_locale']['search_results'], 'path'=>array(			array('name'=>Core::$_data['main_locale']['search_results'], 'url'=>'#')		)));		View::render('search/results', TRUE, array(			'search'	=> Helpers::escape_html($this->_search),			'found'		=> $found		));	}}