const _CRON_AJAX_ = '/cms/modules/cron/ajax/a/';// Включение/Выключение задачиfunction switchTask(obj){	var $container = $(obj).parent().parent();	if (!$container.hasClass('process'))	{		$.getJSON(_CRON_AJAX_+'switch/'+$container.attr('rel'), function(json)		{			if (json.status == 'ok')			{				$(obj).attr('title', json.active_text).find('img').attr('src', '/cms/images/'+json.active+'.png');				if (json.active == 'on') $container.removeClass('disabled');				else $container.addClass('disabled');			}			else error_alert(json.msg);		});	}	else error_alert('Нельзя отключить выполняющуюся задачу');	return false;}// Удаление задачиfunction removeTask(obj){	if (confirm('Удалить задачу?'))	{		var $container = $(obj).parent().parent();		if (!$container.hasClass('process'))		{			$.getJSON(_CRON_AJAX_+'remove/'+$container.attr('rel'), function(json)			{				if (json.status == 'ok') $container.fadeOut("normal", function() { $(this).remove(); });				else error_alert(json.msg);			});		}		else error_alert('Нельзя удалять выполняющуюся задачу');	}	return false;}// Запуск задачиfunction runTask(obj){	var $container = $(obj).parent().parent();	if (!$container.hasClass('disabled'))	{		if (!$container.hasClass('process'))		{			$container.addClass('process');			$(obj).attr('title', 'Выполняется').find('img').attr('src', '/cms/images/process.gif');			$('#run_frame').attr('src', $('#cron_url').text()+'&task='+$container.attr('rel'));		}	}	else error_alert('Задача отключена');	return false;}// Проверка формыfunction checkForm(){	if (($('#cron_start_date').val() == '') || ($('#cron_start_time').val().length < 5))	{		$('#infobox').addClass('errorbox').text('Укажите дату и время запуска задачи').fadeIn('fast');		$('#cron_start_time').focus();	}	else if ($("#cron_name").val() == '')	{		$('#infobox').addClass('errorbox').text('Введите название задачи').fadeIn('fast');		$('#cron_name').focus();	}	else if ($('#cron_contoller').val() == '')	{		$('#infobox').addClass('errorbox').text('Выберите контроллер').fadeIn('fast');		$('#cron_contoller').focus();	}	else return true;	return false;}// DOM$(function(){	// Добавление задачи	$('#cron_add').submit(function()	{		$('#infobox').hide().removeClass('errorbox').empty();		$('#cron_add_btn').prop('disabled', true);		if (checkForm())		{			$.post(_CRON_AJAX_+'add',			{				name		: $('#cron_name').val(),				controller	: $('#cron_contoller').val(),				start		: $('#cron_start_date').val()+' '+$('#cron_start_time').val(),				interval	: $('#cron_interval').val()			},			function(json)			{				if (json.status == 'ok') self.location = '/cms/modules/cron/';				else $('#infobox').addClass('errorbox').text(json.msg).fadeIn('fast');			}, 'json');		}		$('#cron_add_btn').prop('disabled', false);		return false;	});	// Сохраенение задачи	$("#cron_edit").submit(function()	{		$('#infobox').hide().removeClass('errorbox').empty();		$('#cron_edit_btn').prop('disabled', true);		if (checkForm())		{			$.post(_CRON_AJAX_+'edit',			{				id			: $('#cron_id').val(),				name		: $('#cron_name').val(),				controller	: $('#cron_contoller').val(),				start		: $('#cron_start_date').val()+' '+$('#cron_start_time').val(),				interval	: $('#cron_interval').val()			},			function(json)			{				if (json.status == 'ok') self.location = '/cms/modules/cron/';				else $('#infobox').addClass('errorbox').text(json.msg).fadeIn('fast');			}, 'json');		}		$('#cron_edit_btn').prop('disabled', false);		return false;	});	// Ограничения по вводу	$('#cron_interval').keyup(function()	{		digInput($(this));	});	// Календарь	$('#cron_start_date').datepicker();	// Перезагрузка страницы каждую минуту	setTimeout(function() { top.location.reload(); }, 60000);});