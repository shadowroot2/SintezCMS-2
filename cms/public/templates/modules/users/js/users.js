const _USERS_AJAX_ = '/cms/modules/users/ajax/a/';// Добавление доступа группеfunction templateAddAccess(){	$('#group_module_form').dialog(	{		modal		: true,		resizable	: false,		width		: 400,		title		: 'Добавление доступа',		open 		: function()		{			$('#group_module option:first').prop('selected', true).parent().change();			$('#group_access_type').find('input:first').prop('checked', true);			$('#group_module_params').val('');			$('#group_access_add_status').hide().empty();		},		buttons :		{			'Добавить доступ' : function()			{				var msg 		 = '';				var access_found = false;				$('#group_access_add_status').hide().empty();				$('#group_access .access_field').each(function()				{					if ($(this).find('.g_module').attr('title') == $('#group_module').val()) access_found = true;				});				if ($('#group_module').val() == '')				{					msg = 'Выберите модуль';					$('#group_module').focus();				}				else if (access_found == true)				{					msg = 'Доступ уже есть в списке';					$('#group_module').focus();				}				if (msg == '')				{					$('#group_no_access').hide();					$('#group_access').append('<tr class="access_field"><td class="g_module" title="'+$('#group_module').val()+'">'+$('#group_module option:selected').text()+'</td><td class="g_access" title="'+$('#group_access_type input:checked').val()+'" align="center">'+$('#group_access_type input:checked').attr('title')+'</td><td class="g_params">'+$('#group_module_params').val()+'</td><td align="center"><a href="#" onclick="return removeAccess(this)"><img src="/cms/images/del.png" title="Удалить доступ" /></a></td></tr>');					$('#group_module_form').dialog('close');				}				else $('#group_access_add_status').html('<span class="error">'+msg+'</span>').slideDown('fast');			},			'Отмена' : function() {	$(this).dialog('destroy'); }		}	});	return false;}// Удаление доступаfunction removeAccess(obj){	if (confirm('Удалить доступ?'))	{		$(obj).parent().parent().fadeOut('fast', function()		{			$(this).remove();			if ($('#group_access .access_field').length == 0) $('#group_no_access').show();		});	}	return false;}// Удаление группыfunction removeGroup(obj){	if (confirm('Удалить группу и всех пользователей в ней?'))	{		var obj = $(obj).parent().parent();		$.getJSON(_USERS_AJAX_+'gremove/'+$(obj).attr('rel'), function(json)		{			if (json.status == 'ok') $(obj).fadeOut('fast', function() { $(this).remove(); });			else error_alert(json.msg);		});	}	return false;}// Удаление пользователяfunction removeUser(obj){	if (confirm('Удалить пользователя?'))	{		var obj = $(obj).parent().parent();		$.getJSON(_USERS_AJAX_+'uremove/'+$(obj).attr('rel'), function(json)		{			if (json.status == 'ok') $(obj).fadeOut('fast', function() { $(this).remove(); });			else error_alert(json.msg);		});	}	return false;}// Вкл/Выкл группыfunction switchGroup(obj){	var $cont = $(obj).parent().parent();	$.getJSON(_USERS_AJAX_+'gswitch/'+$cont.attr('rel'), function(json)	{		if (json.status == 'ok')		{			$(obj).attr('title', (json.active == 1 ? 'Включена' : 'Отключена'))				.find('img').attr('src', (json.active == 1 ? '/cms/images/on.png' : '/cms/images/off.png'));			if (json.active == 1) $cont.removeClass('disabled');			else $cont.addClass('disabled');		}		else error_alert(json.msg);	});	return false;}// Вкл/Выкл пользователяfunction switchUser(obj){	var $cont = $(obj).parent().parent();	$.getJSON(_USERS_AJAX_+'uswitch/'+$cont.attr('rel'), function(json)	{		if (json.status == 'ok')		{			$(obj).attr('title', (json.active == 1 ? 'Включен' : 'Отключен'))				.find('img').attr('src', (json.active == 1 ? '/cms/images/on.png' : '/cms/images/off.png'));			if (json.active == 1) $cont.removeClass('disabled');			else $cont.addClass('disabled');		}		else error_alert(json.msg);	});	return false;}// DOM$(function(){	// Выбор модуля	$('#group_module').change(function()	{		$('#group_access_type input:first').prop('checked', true);		$('#group_module_params').val('');		if ($(this).val() == '') $('#group_access_type, #group_params_block').addClass('hidden');		else $('#group_access_type, #group_params_block').removeClass('hidden');	});	// Добавление групы	$('#group_add').submit(function()	{		var msg = '';		var access = {};		$('#infobox').hide().removeClass('errorbox').empty();		$('#group_add_btn').prop('disabled', true);		if ($('#group_name').val() == '')		{			msg = 'Введите название группы';			$('#group_name').focus();		}		else if ($('#group_access .access_field').length == 0)		{			msg = 'Группа должна иметь хотябы один доступ';		}		else		{			// Доступы			$('#group_access .access_field').each(function(key, obj)			{				access[key] =				{					module	: $(obj).find('.g_module').attr('title'),					access 	: $(obj).find('.g_access').attr('title'),					params	: $(obj).find('.g_params').text()				}			});		}		if (msg == '')		{			$.post(_USERS_AJAX_+'gadd',			{				name 	: $('#group_name').val(),				access	: access			},			function(json)			{				if (json.status == 'ok') self.location = '/cms/modules/users/';				else $('#infobox').addClass('errorbox').html(json.msg).fadeIn('fast');			}, 'json');		}		else $('#infobox').addClass('errorbox').html(msg).fadeIn('fast');		$('#group_add_btn').prop('disabled', false);		return false;	});	// Сохранение групы	$('#group_edit').submit(function()	{		var msg = '';		var access = {};		$('#infobox').hide().removeClass('errorbox').empty();		$('#group_save_btn').prop('disabled', true);		if ($('#group_name').val() == '')		{			msg = 'Введите название группы';			$('#group_name').focus();		}		else if ($('#group_access .access_field').length == 0)		{			msg = 'Группа должна иметь хотябы один доступ';		}		else		{			// Доступы			$('#group_access .access_field').each(function(key, obj)			{				access[key] =				{					module	: $(obj).find('.g_module').attr('title'),					access	: $(obj).find('.g_access').attr('title'),					params	: $(obj).find('.g_params').text()				}			});		}		if (msg == '')		{			$.post(_USERS_AJAX_+'gedit',			{				gid		: $('#group_id').val(),				name 	: $('#group_name').val(),				access	: access			},			function(json)			{				if (json.status == 'ok') self.location = '/cms/modules/users/';				else $('#infobox').addClass('errorbox').html(json.msg).fadeIn('fast');			},			'json');		}		else $('#infobox').addClass('errorbox').html(msg).fadeIn('fast');		$('#group_save_btn').prop('disabled', false);		return false;	});	// Ограничения по логина	$('#user_login').keyup(function()	{		loginInput($(this));	});	// Добавление пользователя	$('#user_add').submit(function()	{		var msg = '';		$('#infobox').hide().removeClass('errorbox').empty();		$('#user_add_btn').prop('disabled', true);		if ($('#user_group').val() == '')		{			msg = 'Укажите группу';		}		else if ($('#user_name').val() == '')		{			msg = 'Введите имя пользователя';			$('#user_name').focus();		}		else if ($('#user_login').val().length < 3)		{			msg = 'Короткий логин';			$('#user_login').focus();		}		else if ($('#user_passwd').val().length < 6)		{			msg = 'Пароль короче 6 символов';			$('#user_passwd').focus();		}		else if ($('#user_passwd_conf').val() != $('#user_passwd').val())		{			msg = 'Пароли не совпадают';			$('#user_passwd_conf').focus();		}		if (msg == '')		{			$.post(_USERS_AJAX_+'uadd',			{				gid		: $('#user_group').val(),				name 	: $('#user_name').val(),				login 	: $('#user_login').val(),				pass  	: $('#user_passwd').val(),			},			function(json)			{				if (json.status == 'ok') self.location = '/cms/modules/users/gusers/'+$('#user_group').val();				else $('#infobox').addClass('errorbox').html(json.msg).fadeIn('fast');			}, 'json');		}		else $('#infobox').addClass('errorbox').html(msg).fadeIn('fast');		$('#user_add_btn').prop('disabled', false);		return false;	});	// Сохранение пользователя	$('#user_edit').submit(function()	{		var msg = '';		$('#infobox').hide().removeClass('errorbox').empty();		$('#user_edit_btn').prop('disabled', true);		if ($('#user_group').val() == '')		{			msg = 'Укажите группу';		}		else if ($('#user_name').val() == '')		{			msg = 'Введите имя пользователя';			$('#user_name').focus();		}		else if ($('#user_login').val().length < 3)		{			msg = 'Короткий логин';			$('#user_login').focus();		}		else if (($('#user_passwd').val() != '') && ($('#user_passwd').val().length < 6))		{			msg = 'Пароль короче 6 символов';			$('#user_passwd').focus();		}		else if (($('#user_passwd').val() != '') && ($('#user_passwd_conf').val() != $('#user_passwd').val()))		{			msg = 'Пароли не совпадают';			$('#user_passwd_conf').focus();		}		if (msg == '')		{			$.post(_USERS_AJAX_+'uedit',			{				uid		: $('#user_id').val(),				gid		: $('#user_group').val(),				name 	: $('#user_name').val(),				login 	: $('#user_login').val(),				pass  	: $('#user_passwd').val(),			},			function(json)			{				if (json.status == 'ok') self.location = '/cms/modules/users/gusers/'+$('#user_group').val();				else $('#infobox').addClass('errorbox').html(json.msg).fadeIn('fast');			}, 'json');		}		else $('#infobox').addClass('errorbox').html(msg).fadeIn('fast');		$('#user_edit_btn').prop('disabled', false);		return false;	});});