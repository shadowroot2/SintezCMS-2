const _ROUTES_AJAX_ = '/cms/modules/routes/ajax/a/';// Вкл/Выкл маршрутаfunction switchRoute(obj){	var $container = $(obj).parent().parent();	$.getJSON(_ROUTES_AJAX_+'switch/'+$container.attr('rel'), function(json)	{		if (json.status == 'ok')		{			$(obj).attr('title', json.active_text).find('img').attr('src', '/cms/images/'+json.active+'.png');			if (json.active == 'on') $container.removeClass('disabled');			else $container.addClass('disabled');		}		else error_alert(json.msg);	});	return false;}// Удаление маршрутаfunction removeRoute(obj){	if (confirm('Удалить маршрут?'))	{		var obj = $(obj).parent().parent();		$.getJSON(_ROUTES_AJAX_+'remove/'+$(obj).attr('rel'), function(json)		{			if (json.status == 'ok') $(obj).fadeOut("normal", function() { $(this).remove(); });			else error_alert(json.msg);		});	}	return false;}// DOM$(function(){	// Добавление маршрута	$('#route_add').submit(function()	{		$('#infobox').hide().removeClass('errorbox').empty();		$('#route_add_btn').prop('disabled', true);		if ($('#route_route').val() == '')		{			$('#infobox').addClass('errorbox').text('Введите маршрут').fadeIn('fast');			$('#route_route').focus();		}		else if ($('#route_replace').val() == '')		{			$('#infobox').addClass('errorbox').text('Введите замену').fadeIn('fast');			$('#route_replace').focus();		}		else		{			$.post(_ROUTES_AJAX_+'add',			{				route 	: $('#route_route').val(),				replace	: $('#route_replace').val()			},			function(json)			{				if (json.status == 'ok') self.location = '/cms/modules/routes/';				else $('#infobox').addClass('errorbox').html(json.msg).fadeIn('fast');			}, 'json');		}		$('#route_add_btn').prop('disabled', false);		return false;	});	// Сохранение маршрута	$('#route_edit').submit(function()	{		$('#infobox').removeClass('errorbox').html('').hide();		$('#route_edit_btn').prop('disabled', true);		if ($('#route_route').val() == '')		{			$('#infobox').addClass('errorbox').text('Введите маршрут').fadeIn('fast');			$('#route_route').focus();		}		else if ($('#route_replace').val() == '')		{			$('#infobox').addClass('errorbox').text('Введите замену').fadeIn('fast');			$('#route_replace').focus();		}		else		{			// POST			$.post(_ROUTES_AJAX_+'edit/'+$('#route_id').val(),			{				route 	: $('#route_route').val(),				replace	: $('#route_replace').val()			},			function(json)			{				if (json.status == 'ok') self.location = '/cms/modules/routes/';				else $('#infobox').addClass('errorbox').html(json.msg).fadeIn('fast');			}, 'json');		}		$('#route_edit_btn').prop('disabled', false);		return false;	});	// Сортировка	$('.infotable.sortable').sortable(	{		containment	: 'parent',		items		: 'tbody tr',		axis		: 'y',		tolerance	: 'pointer',		distance	: 10,		delay		: 200,		cursor		: 'move',		opacity		: 0.8,		update		: function(event, ui)		{			var item = ui.item;			var curr = $(item).attr('rel');			var prev = 0;			var next = 0;			$(item).addClass('disabled');			// Заганяем текущую сортировку в массив			var sort_mass = new Array();			$('.infotable.sortable tr').each(function(key, obj) { sort_mass[key] = $(obj).attr('rel');	});			// Находим элемент			$(sort_mass).each(function(key, val)			{				if (val == curr)				{					if (key > 0) prev = sort_mass[key-1];					if (key < sort_mass.length-1) next = sort_mass[key+1];				}			});			// Отпраляем			$.post(_ROUTES_AJAX_+'sort/',			{				id	 : curr,				prev : prev,				next : next			},			function(json)			{				if (json.status == 'ok') $(item).removeClass('disabled');				else error_alert(json.msg);			}, 'json');		}	});});