// DOM$(function(){	var _MAIL_TEMPLATES_AJAX_	= '/cms/modules/mailer/ajax/a/';	var _CAN_NOT_CONNECT_		= 'Невозможно подключиться к серверу';	// Календарь	$('#mailer_planed_date').datepicker();	// Редакторы	$('#mailer_text, #mailer_template_text').ckeditor();	// Фильтр	$('#filter_form select').change(function()	{		$('#filter_form').submit();	});	// Переключение запланированной рассылки	$('#mailer_planed').click(function()	{		if ($(this).is(':checked')) $('#mailer_planed_params').show();		else $('#mailer_planed_params').hide();	});	// Переключение типов рассылки	$('.mailer_to_switch').click(function()	{		$('.mailer_to').addClass('hidden').hide();		$('#mailer_to_'+$(this).val()).show().removeClass('hidden');		if ($(this).val() == 2) $('#mailer_replacements').hide();		else $('#mailer_replacements').show();	});	// Проверка форма отправки	$('#mailer_form').submit(function()	{		$('#infobox').hide().removeClass('errorbox').html('');		$('#mailer_send_btn').prop('disabled', true);		if ($('.mailer_to_switch:checked').val() == '')		{			$('#infobox').addClass('errorbox').html('Выберите кому хотите отправить письмо').fadeIn();		}		else if (($('.mailer_to_switch:checked').val() == 1) && ($('.users_list:checked').length == 0))		{			$('#infobox').addClass('errorbox').html('Выберите группу из списка подписчиков').fadeIn();		}		else if (($('.mailer_to_switch:checked').val() == 2) && !email_check.test($('#mailer_to').val()))		{			$('#infobox').addClass('errorbox').html('Укажите корректный e-mail получателя').fadeIn();			$('#mailer_to').focus();		}		else if ($('#mailer_subject').val() == '')		{			$('#infobox').addClass('errorbox').html('Введите тему письма').fadeIn();			$('#mailer_subject').focus();		}		else if ($('#mailer_text').val().length < 10)		{			$('#infobox').addClass('errorbox').html('Короткий текст письма').fadeIn();		}		else return true;		$('#mailer_send_btn').prop('disabled', false);		return false;	});	// Проверка формы шаблонов	function checkTemplate()	{		$('#infobox').hide().removeClass('errorbox').html('');		if ($('#mailer_template_name').val() == '')		{			$('#infobox').addClass('errorbox').text('Введите название наблона').fadeIn();			$('#mailer_template_name').focus();		}		else if ($('#mailer_template_text').val() == '')		{			$('#infobox').addClass('errorbox').text('Шаблон не должен быть пустым').fadeIn();			$('#mailer_template_text').focus();		}		else return true;		return false;	}	// Добавление шаблона	$('#mailer_template_add').submit(function()	{		$('#mailer_template_add_btn').prop('disabled', true);		if (checkTemplate()) return true;		$('#mailer_template_add_btn').prop('disabled', false);		return false;	});	// Реадактирование шаблона	$('#mailer_template_edit').submit(function()	{		$('#mailer_template_edit_btn').prop('disabled', true);		if (checkTemplate()) return true;		$('#mailer_template_edit_btn').prop('disabled', false);		return false;	});	// Удаление шаблона	$('#mail_templates_table .remove').click(function()	{		if (confirm('Удалить шаблон письма?'))		{			var $obj = $(this).parent().parent();			$.getJSON(_MAIL_TEMPLATES_AJAX_+'removetemplate/'+$obj.attr('rel'), function(json)			{				if (typeof json == 'object')				{					if (json.status == 'ok') $obj.fadeOut(400, function() { $(this).remove(); });					else error_alert(json.msg);				}				else error_alert(_CAN_NOT_CONNECT_);			});		}		return false;	});});